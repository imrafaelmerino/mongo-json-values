language: java

install: mvn install

before_install:
- openssl aes-256-cbc -K $encrypted_b9997e150274_key -iv $encrypted_b9997e150274_iv
  -in key.asc.enc -out key.asc -d

after_success:
  - bash <(curl -s https://codecov.io/bash)


deploy:
  - provider: script
    script: mvn deploy --settings .travis/settings.xml -DskipTests=true -B -U -Prelease
    skip_cleanup: true
    on:
      repo: imrafaelmerino/mongo-values
      tags: true
  - provider: releases
    skip_cleanup: true
    api_key: $GITHUB_TOKEN
    draft: false
    prerelease: false
    body: "Generated by TravisCI during the release process: build URL: $TRAVIS_BUILD_WEB_URL, build number: $TRAVIS_BUILD_NUMBER, commit: $TRAVIS_COMMIT, tag: $TRAVIS_TAG"
    name: Astro
    file:
      - target/JAVADOC.zip
      - docs/CHANGELOG.md
      - docs/README.md
      - target/SOURCES.zip
    on:
      repo: imrafaelmerino/mongo-values
      tags: true

addons:
  sonarcloud:
    organization: "imrafaelmerino"
    token:
      secure: "vjIX5bJpzaPfwIi8nhVuIu7IIsOTq0ava5aC++PaeFshGwqMH0uRzaEGKqSDmqaKP41R89L/BCOnPJQ12Geq9uu+qdZqK45Tcsn8cqBcAL8au0MTeQeQ3mNEtCKVkMmTgT4zNCBtf2ZGfC+3hLiHocHLH0zNJcNq9lesI2ULH5SqciOPciueIBEx4zx2UNKDNBC6YI34Sa4yBp9ntXc/xxs+53GGxbmSrrVAp7KstN5wAlh1D8tmeBFF9vkZQB07oo6GOKebOqmLiPEtphQ6t2Zg7Viq9tWQSAx4AVDCaoiEhMeR5pI8+sknmttQQq71Wk/xObNeRogMXcIxLzQ0CHAtwQOMSutdOO3W0QqOl208krwz1jnZl0Ne/BjK54dP0vOHOK6dGusDWU1XDaOY8wn+DOiddSHy6Y5U7S9W2BuIQ+RJvJejdEVmWknNvOIOShsWEry7+tT4z//EXHe9Vfdihzltqxy6HHBxuB4DvLiGH90dFF8Jqz1he76QiuweJOUufGcuExEyKJNq7jSRfXBX/KzLJMDIiAX1BPviRu9CO7WDntkyKu+fZf/eCmkzjjvgT00CCFwIYZ129JULVgB+bBDMI/aIkRYF0qC9KeL2H9o3Hm51kBJWt6xQZL8rP/o6AhtJS4GCB7v/RHOdtRAzcudiJLLZqg0s8Ago344="



script:
  # the following command line builds the project, runs the tests with coverage and then execute the SonarCloud analysis
  - mvn clean verify sonar:sonar -Pcoverage -Dsonar.projectKey=imrafaelmerino_mongo-values